#!/usr/bin/env bash

# Specify the path to your default Nginx configuration file
nginx_conf="/etc/nginx/sites-enabled/default"

# Define the header to be added
header_line="    add_header X-Served-By \$hostname;"

# Check if the configuration file exists
if [ -f "$nginx_conf" ]; then
    # Append the header line to the server block
    sed -i "/^server {/a $header_line" "$nginx_conf"
    
    # Test the Nginx configuration
    nginx -t

    # If the configuration test is successful, restart Nginx
    if [ $? -eq 0 ]; then
        systemctl restart nginx
        echo "Header added successfully. Nginx restarted."
    else
        echo "Error: Nginx configuration test failed. Please check your configuration."
    fi
else
    echo "Error: Nginx configuration file not found at $nginx_conf."
fi

# restart the web server after updating the settings
sudo service nginx restart
